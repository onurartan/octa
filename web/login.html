<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Sign In - Octa ConsoleUI</title>

    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />

    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            fontFamily: { sans: ['"Inter"', "sans-serif"] },
            colors: {
              brand: {
                50: "#eef2ff",
                500: "#6366f1",
                600: "#514AE6", // Octa Brand
                700: "#4338ca",
              },
              dark: {
                900: "#0f172a",
                950: "#020617",
              },
            },
            backgroundImage: {
              "grid-pattern":
                "linear-gradient(to right, #f1f5f9 1px, transparent 1px), linear-gradient(to bottom, #f1f5f9 1px, transparent 1px)",
            },
          },
        },
      };
    </script>
    <script
      defer
      src="https://cdn.jsdelivr.net/npm/alpinejs@3.13.3/dist/cdn.min.js"
    ></script>
    <script>
      window.GO_CONFIG = { BASE_URL: "{{.BaseURL}}" || window.location.origin };
    </script>
    <style>
      [x-cloak] {
        display: none !important;
      }
    </style>
  </head>
  <body
    class="h-screen w-full flex items-center justify-center relative overflow-hidden bg-white text-slate-800 antialiased"
    x-data="loginApp()"
  >
    <div
      class="absolute inset-0 bg-grid-pattern bg-[length:40px_40px] opacity-[0.6] z-0"
    ></div>
    <div
      class="absolute top-[-10%] left-[-10%] w-[500px] h-[500px] bg-brand-50 rounded-full blur-[100px] opacity-60 animate-pulse"
    ></div>
    <div
      class="absolute bottom-[-10%] right-[-10%] w-[400px] h-[400px] bg-purple-50 rounded-full blur-[100px] opacity-60"
    ></div>

    <div
      class="relative z-10 w-full max-w-sm bg-white/80 backdrop-blur-xl p-8 rounded-3xl shadow-2xl border border-white/50 ring-1 ring-slate-100"
    >
      <div class="text-center mb-8">
        <div
          class="inline-flex items-center justify-center w-14 h-14 rounded-2xl bg-gradient-to-br from-brand-50 to-white border border-brand-100 shadow-sm mb-5 group overflow-hidden"
        >
          <svg
            width="100"
            height="100"
            viewBox="0 0 100 100"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
          >
            <rect width="100" height="100" fill="#fff" />
            <path
              d="M50 19.5C61.4251 19.5 70.2601 23.2952 76.2324 29.2676C82.2145 35.2496 85.5 43.5902 85.5 53C85.5 62.4776 82.6821 69.1529 77.1885 73.5479C71.5805 78.0342 62.754 80.5 50 80.5C37.246 80.5 28.4195 78.0342 22.8115 73.5479C17.3179 69.1529 14.5 62.4776 14.5 53C14.5 43.5902 17.7855 35.2496 23.7676 29.2676C29.7399 23.2952 38.5749 19.5 50 19.5Z"
              stroke="#5A589A"
              stroke-width="5"
            />
          </svg>
        </div>
        <h1 class="text-2xl font-bold text-dark-900 tracking-tight">
          Octa ConsoleUI
        </h1>
        <p class="text-sm text-slate-500 mt-2 font-medium">
          Authenticate to manage assets.
        </p>
      </div>

      <form @submit.prevent="submit" class="space-y-5">
        <div>
          <label
            class="block text-xs font-bold text-slate-500 uppercase mb-1.5 ml-1"
            >Username</label
          >
          <div class="relative">
            <div
              class="absolute inset-y-0 left-0 pl-3.5 flex items-center pointer-events-none text-slate-400"
            >
              <svg
                class="h-5 w-5"
                fill="none"
                viewBox="0 0 24 24"
                stroke="currentColor"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"
                />
              </svg>
            </div>
            <input
              type="text"
              x-model="user"
              :class="error ? 'border-red-300 focus:border-red-500 focus:ring-red-100' : 'border-slate-200 focus:border-brand-500 focus:ring-brand-50'"
              class="w-full pl-10 pr-4 py-2.5 rounded-xl border bg-white focus:ring-4 outline-none transition text-slate-700 placeholder-slate-400 font-medium shadow-sm"
              placeholder="admin"
            />
          </div>
        </div>

        <div x-data="{ showPass: false }">
          <label
            class="block text-xs font-bold text-slate-500 uppercase mb-1.5 ml-1"
            >Password</label
          >
          <div class="relative">
            <div
              class="absolute inset-y-0 left-0 pl-3.5 flex items-center pointer-events-none text-slate-400"
            >
              <svg
                class="h-5 w-5"
                fill="none"
                viewBox="0 0 24 24"
                stroke="currentColor"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"
                />
              </svg>
            </div>
            <input
              :type="showPass ? 'text' : 'password'"
              x-model="pass"
              :class="error ? 'border-red-300 focus:border-red-500 focus:ring-red-100' : 'border-slate-200 focus:border-brand-500 focus:ring-brand-50'"
              class="w-full pl-10 pr-10 py-2.5 rounded-xl border bg-white focus:ring-4 outline-none transition text-slate-700 placeholder-slate-400 font-medium shadow-sm"
              placeholder="••••••••"
            />

            <button
              type="button"
              @click="showPass = !showPass"
              class="absolute inset-y-0 right-0 pr-3 flex items-center text-slate-400 hover:text-slate-600 cursor-pointer focus:outline-none"
            >
              <svg
                x-show="!showPass"
                class="h-5 w-5"
                fill="none"
                viewBox="0 0 24 24"
                stroke="currentColor"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"
                />
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"
                />
              </svg>
              <svg
                x-show="showPass"
                class="h-5 w-5"
                fill="none"
                viewBox="0 0 24 24"
                stroke="currentColor"
                x-cloak
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.542-7a10.05 10.05 0 011.574-2.59M5.7 5.7a26.136 26.136 0 013.296-1.543C10.076 3.666 11.028 3.5 12 3.5c4.478 0 8.268 2.943 9.542 7a10.057 10.057 0 01-2.095 3.398m-1.579 1.579c-.77.56-1.636.993-2.569 1.257M3 3l18 18"
                />
              </svg>
            </button>
          </div>
        </div>

        <div
          x-show="error"
          x-transition:enter="transition ease-out duration-200"
          x-transition:enter-start="opacity-0 translate-y-2"
          x-transition:enter-end="opacity-100 translate-y-0"
          class="p-3 bg-red-50 text-red-600 text-xs font-semibold rounded-lg flex items-start gap-2 border border-red-100"
          x-cloak
        >
          <svg
            class="w-4 h-4 shrink-0 mt-0.5"
            fill="none"
            viewBox="0 0 24 24"
            stroke="currentColor"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"
            />
          </svg>
          <span x-text="error" class="leading-relaxed"></span>
        </div>

        <button
          type="submit"
          :disabled="loading"
          class="w-full py-3 bg-dark-900 text-white font-bold rounded-xl hover:bg-dark-950 hover:shadow-lg hover:shadow-dark-900/20 active:scale-[0.98] transition-all duration-200 flex items-center justify-center gap-2 disabled:opacity-70 disabled:cursor-not-allowed disabled:hover:shadow-none disabled:active:scale-100"
        >
          <svg
            x-show="loading"
            class="animate-spin h-4 w-4 text-brand-300"
            xmlns="http://www.w3.org/2000/svg"
            fill="none"
            viewBox="0 0 24 24"
          >
            <circle
              class="opacity-25"
              cx="12"
              cy="12"
              r="10"
              stroke="currentColor"
              stroke-width="4"
            ></circle>
            <path
              class="opacity-75"
              fill="currentColor"
              d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"
            ></path>
          </svg>
          <span x-text="loading ? 'Verifying Identity...' : 'Sign In'"></span>
          <svg
            x-show="!loading"
            class="w-4 h-4 text-brand-300"
            fill="none"
            viewBox="0 0 24 24"
            stroke="currentColor"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M14 5l7 7m0 0l-7 7m7-7H3"
            />
          </svg>
        </button>
      </form>

      <div class="mt-6 text-center">
        <p class="text-[10px] text-slate-400 font-medium">
          Secured by RUID Protocol
        </p>
      </div>
    </div>

    <script>
      function loginApp() {
        return {
          user: "",
          pass: "",
          loading: false,
          error: "",
          baseUrl: window.GO_CONFIG.BASE_URL,

          async submit() {
            this.error = "";

            if (!this.user.trim() || !this.pass.trim()) {
              this.error = "Please enter both username and password.";
              return;
            }

            this.loading = true;

            try {
              // Ensure no trailing slash for clean URL
              const cleanBase = this.baseUrl.endsWith("/")
                ? this.baseUrl.slice(0, -1)
                : this.baseUrl;

              const res = await fetch(`${cleanBase}/console/api/login`, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({
                  username: this.user,
                  password: this.pass,
                }),
              });

              if (res.status >= 500)
                throw new Error(
                  "Server is currently unavailable. Please check logs.",
                );
              if (res.status === 404)
                throw new Error("Login endpoint not found.");

              const data = await res.json().catch(() => null);

              if (res.ok) {
                window.location.href = "/admin/dashboard";
              } else {
                throw new Error(
                  data?.message || "Invalid credentials provided.",
                );
              }
            } catch (e) {
              console.error("Login Error:", e);

              if (e.name === "TypeError" && e.message === "Failed to fetch") {
                this.error = "Connection failed. Is the octa server running?";
              } else {
                this.error = e.message;
              }
            } finally {
              this.loading = false;
            }
          },
        };
      }
    </script>
  </body>
</html>
